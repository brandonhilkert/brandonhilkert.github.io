
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Relative Timestamps in Rails | Brandon Hilkert</title>
	<meta name="author" content="Brandon Hilkert">

	
	<meta name="description" content="November 27th, 2013 Relative Timestamps in Rails javascript, jquery, rails, ruby, timestamps Comment systems and forum software made the relative timestamp &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Brandon Hilkert" type="application/atom+xml">
	
	<link rel="canonical" href="http://brandonhilkert.com/blog/relative-timestamps-in-rails/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Sorts+Mill+Goudy:400,400italic' rel='stylesheet' type='text/css'>
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:300" rel="stylesheet" type="text/css">
  <link rel="author" href="https://plus.google.com/u/0/116002935339410846674" />
</head>


<body>
	<div class="container">
		<div class="left-col">
			<header id="header"><div class="profilepic">
  <a href="/">
    <img src="/images/brandon-hilkert.jpg" width="80" height="80" alt="Brandon Hilkert Profile Picture" />
  </a>
</div>
<hgroup>
  <h1><a href="/">Brandon Hilkert</a></h1>
  
</hgroup>

<nav id="main-nav">
  <ul class="main-navigation">
    <li><a href="/about">About</a></li>
    <li><a href="/">Blog</a></li>
    <li><a href="http://railsmasterclass.com">Workshop</a></li>
  </ul>
  <section class="aboutme">
    <p>
      Hi. I'm Brandon.
      <br />
      I'm a technology entrepreneur in PA.
    </p>
  </section>
</nav>

<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/brandonhilkert" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/brandonhilkert" title="GitHub">GitHub</a>
		
		
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/brandonhilkert">LinkedIn</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
<!-- Begin MailChimp Signup Form -->
<div class="newsletter-form">
  <h3>Email Updates</h3>
  <form action="http://brandonhilkert.us7.list-manage2.com/subscribe/post?u=34ccc3aa2135746d0231c9420&amp;id=167c8d9713" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email" required>
    <br class="clear">
    <input type="hidden" name="SIGNUP" id="SIGNUP" value="nav" />
    <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
    <br class="clear">
  </form>
</div>
<!--End mc_embed_signup-->


</header>
		</div>
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="date">








  


<time datetime="2013-11-27T11:05:00-05:00" data-updated="true" itemprop="datePublished">November 27<span>th</span>, 2013</time></div>
	<h1 class="title" itemprop="name">Relative Timestamps in Rails</h1>
  <div class="tags">


	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/jquery/'>jquery</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/timestamps/'>timestamps</a>


</div>
	<div class="entry-content" itemprop="articleBody"><p>Comment systems and forum software made the relative timestamp format of &ldquo;X
hours ago&rdquo; a popular option. For good reason too&hellip;why print an absolute
timestamp so that people have to do the calculation in their head.</p>

<h3>Rails helpers to the rescue</h3>

<p>Rails has a view helper aptly named <code>time_ago_in_words</code>. So if you used the
<code>created_at</code> field from a record, once could easily embed a relative timestamp
in their views:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Posted</span><span class="p">:</span> <span class="o">&lt;%=</span> <span class="n">time_ago_in_words</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span> <span class="o">%&gt;</span> <span class="n">ago</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is great! Er&hellip;except when a user sits on a page for a couple hours and
the post are no longer posted &ldquo;1 minute ago&rdquo;.</p>

<!--more-->


<p>Additionally, Rails 4 encourages the use of <a href="http://edgeguides.rubyonrails.org/caching_with_rails.html">russian doll
caching</a>, so if you
cached the comments of a post, the relative time of the post would never change
with time. No bueno!</p>

<h3>The Solution</h3>

<p><a href="http://timeago.yarp.com/">Timeago.js</a> is a jQuery plugin that converts
timestamps to their relative format. They also boast the following on their
website:</p>

<ul>
<li><p>Avoid timestamps dated &ldquo;1 minute ago&rdquo; even though the page was opened 10
minutes ago; timeago refreshes automatically.</p></li>
<li><p>You can take full advantage of page caching in your web applications, because
the timestamps aren&rsquo;t calculated on the server.</p></li>
<li><p>You get to use microformats like the cool kids.</p></li>
</ul>


<p>Here&rsquo;s how I use it&hellip;</p>

<p>Download the plugin and place in <code>vendor/javascripts/timeago.jquery.js</code>.</p>

<p>Add the following line to your <code>application.js</code> manifest file, so it&rsquo;s picked
up by the asset pipeline:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">jquery</span><span class="o">.</span><span class="n">timeago</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create a helper that you can use from your views that will do the dirty work for you:</p>

<figure class='code'><figcaption><span>app/helpers/application.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Module</span> <span class="no">ApplicationHelper</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">timeago</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>    <span class="n">options</span><span class="o">[</span><span class="ss">:class</span><span class="o">]</span> <span class="o">||=</span> <span class="s2">&quot;timeago&quot;</span>
</span><span class='line'>    <span class="n">content_tag</span><span class="p">(</span>
</span><span class='line'>      <span class="ss">:time</span><span class="p">,</span>
</span><span class='line'>      <span class="n">time</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span>
</span><span class='line'>      <span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">datetime</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">getutc</span><span class="o">.</span><span class="n">iso8601</span><span class="p">)</span>
</span><span class='line'>    <span class="p">)</span> <span class="k">if</span> <span class="n">time</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>From your views, use the new helper:</p>

<figure class='code'><figcaption><span>app/views/posts/show.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;%=</span> <span class="n">timeago</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This generates the following HTML tag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;time</span> <span class="na">class=</span><span class="s">&quot;timeago&quot;</span> <span class="na">datetime=</span><span class="s">&quot;2013-11-08T20:05:37Z&quot;</span> <span class="na">title=</span><span class="s">&quot;2013-11-08 20:05:37 UTC&quot;</span><span class="nt">&gt;&lt;/time&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that <code>timeago.js</code> is loaded and you have the right HTML tags on the page,
you need to invoke the plugin and let it do its thing. Add the following to the
bottom of your layout for this to work on all pages of your application:</p>

<figure class='code'><figcaption><span>app/views/layouts/application.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="cp">&lt;%=</span> <span class="n">javascript_tag</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">  $(function() {</span>
</span><span class='line'><span class="x">    $(&quot;time.timeago&quot;).timeago();</span>
</span><span class='line'><span class="x">  });</span>
</span><span class='line'><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Once the <code>timeago()</code> function is called, the timestamp above will look like:</p>

<figure class='code'><figcaption><span>app/views/layouts/application.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;time class=&quot;timeago&quot; datetime=&quot;2013-11-08T20:05:37Z&quot; title=&quot;2013-11-08 20:05:37 UTC&quot;&gt;2 days ago&lt;/time&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s it&hellip;sit on the page long enough and watch the timestamps increment.
You&rsquo;ve now got yourself a solution that is dynamic and allows you to cache the
views until the cows come home!</p>

<h3>In Summary</h3>

<p>While Rails paved the way for simple relatively timestamps, moving this
mechanism to the client side makes sense. Another benefit you get is that the
plugin will interpret the local timezone for you. So even though we print the
UTC time in the HTML tag, the plugin will detect the local timezone from the
browser and adjust accordingly. In my experience, timezones are a huge pain and
the more you can offload to a solution like this, the better.</p>

<p>Happy timestamping!</p>
</div>
  <section class="newsletter">
  <h3>
    Like this post?
    <br />
    Subscribe below to receive updates by email
  </h3>
  <form action="http://brandonhilkert.us7.list-manage2.com/subscribe/post?u=34ccc3aa2135746d0231c9420&amp;id=167c8d9713" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email" required>
    <br class="clear">
    <input type="hidden" name="SIGNUP" id="SIGNUP" value="Relative Timestamps in Rails" />
    <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
    <br class="clear">
  </form>
  <aside>
    I hate spam as much as you do!
    <br />
    Unsubscribe at any time.
  </aside>
</section>



</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">

	
  <a href="http://bufferapp.com/add" class="buffer-add-button" data-count="horizontal" data-via="brandonhilkert" >Buffer</a>
  <script type="text/javascript" src="http://static.bufferapp.com/js/button.js"></script>
	

	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	

	
	<a class="addthis_button_tweet"></a>
	

	
  <script type="IN/Share" data-counter="right"></script>
	

	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	

	<!-- <a class="addthis_counter addthis_pill_style"></a> -->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Brandon Hilkert
</p>
</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'brandonhilkert';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://brandonhilkert.com/blog/relative-timestamps-in-rails/';
        var disqus_url = 'http://brandonhilkert.com/blog/relative-timestamps-in-rails/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-24469169-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-24469169-2', 'brandonhilkert.com');
    ga('send', 'pageview');
  </script>



		</div>
	</div>
</body>
</html>
