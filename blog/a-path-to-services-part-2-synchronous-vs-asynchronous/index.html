
<!DOCTYPE HTML>
<html xmlns:og="http://ogp.me/ns#" xmlns:fb="http://ogp.me/ns/fb#">
<head>
	<meta charset="utf-8">
	
	
	
  
  
  <title>A Path to Services - Part 2 - Synchronous vs. Asynchronous | Brandon Hilkert</title>
	<meta name="author" content="Brandon Hilkert">

	<meta name="description" content="August 14th, 2015 A Path to Services - Part 2 - Synchronous vs. Asynchronous microservices, rails, ruby This article was originally posted on the &hellip;">
	

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:creator" content="@brandonhilkert">
  <meta name="twitter:title" content="A Path to Services - Part 2 - Synchronous vs. Asynchronous">
  <meta name="twitter:description" content="August 14th, 2015 A Path to Services - Part 2 - Synchronous vs. Asynchronous microservices, rails, ruby This article was originally posted on the PipelineDeals Engineering
Blog In the previous &hellip;">
  <meta name="twitter:image" content="http://brandonhilkert.com/images/brandon-hilkert.jpg">

  <meta property="og:title" content="A Path to Services - Part 2 - Synchronous vs. Asynchronous | Brandon Hilkert"/>
  <meta property="og:description" content="August 14th, 2015 A Path to Services - Part 2 - Synchronous vs. Asynchronous microservices, rails, ruby This article was originally posted on the PipelineDeals Engineering
Blog In the previous &hellip;">
  <meta property="og:url" content="http://brandonhilkert.com/blog/a-path-to-services-part-2-synchronous-vs-asynchronous/"/>
  <meta property="og:image" content="http://brandonhilkert.com/images/brandon-hilkert-large.jpg" />
  <meta property="og:site_name" content="Brandon Hilkert's Blog"/>
  <meta property="og:type" content="article"/>
  <meta property="fb:profile_id" content="1472745932"/>

	<link href="/atom.xml" rel="alternate" title="A Path to Services - Part 2 - Synchronous vs. Asynchronous | Brandon Hilkert" type="application/atom+xml">
	<link rel="canonical" href="http://brandonhilkert.com/blog/a-path-to-services-part-2-synchronous-vs-asynchronous/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:300" rel="stylesheet" type="text/css">
  <link rel="author" href="https://plus.google.com/u/0/116002935339410846674" />
  <script src="/javascripts/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-24469169-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>

</head>


<body>
	<div class="container">
		<div class="left-col">
			<header id="header"><div class="profilepic">
  <a href="/">
    <img src="/images/brandon-hilkert.jpg" width="80" height="80" alt="Brandon Hilkert Profile Picture" />
  </a>
</div>
<hgroup>
  <h1><a href="/">Brandon Hilkert</a></h1>
  
</hgroup>

<nav id="main-nav">
  <ul class="main-navigation">
    <li><a href="/about/">About</a></li>
    <li><a href="/">Blog</a></li>
    <li><a href="/newsletter/">Newsletter</a></li>
    <!-- <li> -->
    <!--   <a href="/courses/build&#45;a&#45;ruby&#45;gem/">Courses</a> -->
    <!-- </li> -->
    <li>
      <div class="new-label">New</div>
      <a href="/books/build-a-ruby-gem/">Books</a>
    </li>
    <li>
      <a href="/talks/">Talks</a>
    </li>
    <!-- <li> -->
    <!--   <a href="/tools/">Tools</a> -->
    <!-- </li> -->
  </ul>
</nav>

<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="https://twitter.com/brandonhilkert" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/brandonhilkert" title="GitHub">GitHub</a>
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/brandonhilkert">LinkedIn</a>
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>

<aside class="popular-posts">
  <h4>Popular Posts</h4>
<ul>
  <li>
    <a href="/blog/7-reasons-why-im-sticking-with-minitest-and-fixtures-in-rails/">7 Reasons I'm sticking with Minitest</a>
  </li>
  <li>
    <a href="/blog/organizing-javascript-in-rails-application-with-turbolinks/">Organizing JS in Rails w/ Turbolinks</a>
  </li>
  <li>
    <a href="/blog/using-rails-4-dot-1-secrets-for-configuration/">Using Rails 4 Secrets for Config</a>
  </li>
  <li>
    <a href="/blog/using-rails-fixtures-to-seed-a-database/">Using Fixtures to Seed a Database</a>
  </li>
  <li>
    <a href="/blog/ruby-gem-configuration-patterns/">Ruby Gem Configuration Patterns</a>
  </li>
  <!-- <li> -->
  <!--   <a href="/blog/how&#45;to&#45;build&#45;a&#45;rails&#45;engine/">How to Build a Rails Engine</a> -->
  <!-- </li> -->
  <!-- <li> -->
  <!--   <a href="/blog/why&#45;i&#45;wrote&#45;the&#45;sucker&#45;punch&#45;gem/">Why I Wrote the Sucker Punch Gem</a> -->
  <!-- </li> -->
  <!-- <li> -->
  <!--   <a href="/blog/setting&#45;up&#45;a&#45;cloudfront&#45;cdn&#45;for&#45;rails/">Setup a Cloudfront CDN for Rails</a> -->
  <!-- </li> -->
  <!-- <li> -->
  <!--   <a href="/blog/3&#45;ways&#45;to&#45;get&#45;started&#45;contributing&#45;to&#45;open&#45;source/">Get Started with Open Source</a> -->
  <!-- </li> -->
</ul>


</aside>

</header>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
  <div class="date">








  


<time datetime="2015-08-14T10:32:00-04:00" data-updated="true" itemprop="datePublished">August 14<span>th</span>, 2015</time></div>
	<h1 class="title" itemprop="name">A Path to Services - Part 2 - Synchronous vs. Asynchronous</h1>
  <div class="tags">


	<a class='category' href='/blog/categories/microservices/'>microservices</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>


</div>
	<div class="entry-content" itemprop="articleBody">
    

    <p><em>This article was originally posted on the <a href="http://plumbing.pipelinedeals.com/">PipelineDeals Engineering
Blog</a></em></p>

<p>In the <a href="/blog/a-path-to-services-part-1-start-small/">previous article in this series</a>, we moved the responsibility of emails to a separate Rails application. In order to leverage this new service, we created a PORO to encapsulate the specifics of communicating with our new service by taking advantage of Sidekiq&rsquo;s built-in retry mechanism to protect from intermittent network issues.</p>

<p>Communication between microservices can be broken down in to 2 categories: <strong>synchronous</strong> and  <strong>asynchronous</strong>.
Understanding when to use each is critical in maintaining a healthy infrastructure. This post will explore details about these two methods of communication and their associated use cases.</p>

<!--more-->


<h2>Background</h2>

<p>Continuing the discussion of our architecture from last time, we have a primary
Rails web application serving the majority of our business logic. We now have an additional application that&rsquo;s only responsibility is the formatting and sending of emails.</p>

<p><img class="center" src="/images/services/app-email.png" title="&#34;Application service with email microservice&#34;" alt="&#34;Application service with email microservice&#34;"></p>

<p>In this article, we&rsquo;ll discuss the addition of our Billing service. The service&rsquo;s responsibility to is to process transactions related to money. This can come in the form of a trial conversion, adding a seat to an additional account, or deleting users from an existing account, among others.</p>

<p>Like many SaaS applications, PipelineDeals has multiple tiers of service. The most expensive intended for customers needing advanced functionality. Part of the billing service&rsquo;s responsibility is to manage the knowledge of which features an account can access.</p>

<p>So stepping back to the main PipelineDeals web application, the app has to decide which features to render at page load. Because the billing service is our source of truth for this information, a page load will now require a call to this service to understand which features to render.</p>

<p>This new dependency looks a little different than the email dependency from the
<a href="/blog/a-path-to-services-part-1-start-small/">previous article</a>. Email has the
luxury of not being in the dependency path of a page load. Very few customers
will complain if an email is 10 seconds late. On the other hand, they&rsquo;ll
complain immediately if their account won&rsquo;t load, and rightfully so.</p>

<p><img class="center" src="/images/services/app-email-billing.png" title="&#34;Application service include email and billing microservices&#34;" alt="&#34;Application service include email and billing microservices&#34;"></p>

<p>An interesting benefit from having already extracted the email service is that the billing service sends email regarding financial transactions and account changes. Typically, we would have done the same thing for every other Rails app that needed to send email, which was integrate <code>ActionMailer</code> and setup the templates and mailers needed to do the work. In this case, we can add those emails to the email service and use the same communication patterns we do from the main web application to trigger the sending of an email from the billing service. This does require making changes to 2 different projects for a single feature (business logic in billing and mailer in email), but removes the necessity to configure another app to send email properly. We viewed this as a benefit.</p>

<h2>Asynchronous Events</h2>

<p>As the easier of the two, asynchronous would be any communication not necessary for the request/response cycle to complete. Email is the perfect example. Logging also falls in to this category.</p>

<p>For the networks gurus out there, this would be similar to UDP communication. More of a fire-and-forget approach.</p>

<p>An email, in this case, is triggered due to something like an account sign up.
We send a welcome email thanking the customer for signing up and giving them
some guidance on how to get the most benefit from the application. Somewhere in
the process of signing up, the code triggers an email and passes along the data
needed for email template.</p>

<p>As shown in the previous article, the call to send the email looks something like this:</p>

<figure class='code'><pre><code>Email.to current_user, :user_welcome</code></pre></figure>


<p>The value in this call is that under the covers, it&rsquo;s enqueuing a Sidekiq job:</p>

<figure class='code'><pre><code>EmailWorker.perform_async(opts)</code></pre></figure>


<p>where <code>opts</code> is a hash of data related to the email and the variables needed for the template.</p>

<p><em>Note: Because the options are serialized to JSON, values in hash must be simple structures. Objects won&rsquo;t work here.</em></p>

<p>As you can see above, the code invoking the <code>Email.to</code> method doesn&rsquo;t care about what it returns. In fact, it doesn&rsquo;t return anything we care about at this point. So as long as the method is called, the code can move forward without waiting for the email to finish sending.</p>

<p>Extracting asynchronous operations like this that exist in a code path is a
great way to improve performance. There are times, though, where deferring an operation to background job might not make sense.</p>

<p>For example, imagine a user changes the name of a person. They click one of their contact&rsquo;s names, enter a new name, and click &ldquo;Save&rdquo;. It doesn&rsquo;t make sense to send the task of updating the actual name in the database to a background job because depending on what else is in the queue at that time, the update might not complete until after the next refresh, which would make the user believe their update wasn&rsquo;t successful. This would be incredibly confusing.</p>

<p>Logging is another perfect candidate for asynchronicity. In most cases, our users don&rsquo;t care if a log of their actions has been written to the database before their next refresh. It&rsquo;s information we may want to store, and as a result, can be a fire-and-forget operation. We can rest easy knowing we&rsquo;ll have that information, soon-ish, and it won&rsquo;t add any additional overhead to the end user&rsquo;s request cycle.</p>

<p>The opposite of asynchronous events like this are <strong>synchronous</strong> events! (surprise right?). Let&rsquo;s explore how they&rsquo;re different.</p>

<h2>Synchronous Events</h2>

<p>We can look at synchronous events as dependencies of the request cycle. We use MySQL as a backend for the main PipelineDeals web application and queries to MySQL would be considered synchronous. In that, in order to successfully fulfill the current request, we require the information returned from MySQL before we can respond.</p>

<p>In most cases, we don&rsquo;t think of our main datastore as a service. It doesn&rsquo;t necessarily have a separate application layer on top of it, but it&rsquo;s behavior and requirements are very much like a service.</p>

<p>If we consider the addition of our billing service above, we require information about the features allowed for a particular account before we can render the page. This allows us to include/exclude modules they should or should not see. The flow goes something like this:</p>

<p><code>Web request -&gt; lookup account in DB -&gt; Request features from Billing service -&gt; render page</code></p>

<p>If the request to the billing service didn&rsquo;t require a response, we would consider this to be an <strong>asynchronous</strong> service, which might change how we invoke the request for data.</p>

<p>Synchronous communication can happen over a variety of protocols. The most
common is a JSON payload over HTTP. In general, it&rsquo;s not the most performant,
but it&rsquo;s one of the easier to debug and is human-readable, so it tends to be pretty popular.</p>

<p>The synchronous services we&rsquo;ve setup all communicate over HTTP. Rails APIs are a known thing. We&rsquo;re familiar with the stack and the dependencies required to set up a common JSON API, which is a large part of the reason it&rsquo;s our preferred communication protocol between services.</p>

<h2>Summary</h2>

<p>We&rsquo;ve simplified the communication between services into these two categories. Knowing this helps dictate the infrastructure and configuration of the applications.</p>

<p>Next time, we&rsquo;ll take a closer look at the synchronous side and the specifics about the JSON payloads involved to send an email successfully.</p>

  </div>

  
    <script src="/javascripts/funnel-tools-funnel.min.js"></script>

<div class="funnel-tools-funnel funnel-tools-funnel-default">
  <section class="newsletter-top">
  <img src="/images/newsletter/brandon-hilkert-point-down.png" alt="Brandon Hilkert pointing down">
</section>
<section class="newsletter clearfix">
  <div class="ribbon">
    <span>
      Join 4,000+ Rubyists
    </span>
  </div>
  <section class="picture">
    <img src="/images/newsletter/brandon-hilkert-point-right.png" alt="Brandon Hilkert pointing right">
  </section>
  <section class="signup">
    <h2>Want More?</h2>
    <h3>Ruby and Rails tips delivered to <br />your inbox twice a month</h3>

    <form data-drip-embedded-form="6902355" action="https://www.getdrip.com/forms/6902355/submissions" method="post">
  <div class="email-input-container">
    <input type="email" value="" name="fields[email]" class="email" placeholder="your@email.com" required>
  </div>
  <input type="hidden" name="fields[location]" value="A Path to Services - Part 2 - Synchronous vs. Asynchronous" />
  <input type="submit" value="Send me articles like this!" name="subscribe" class="button">
  <br class="clear">
</form>



    <aside>
      I hate spam as much as you do!
      <br />
      Unsubscribe at any time.
    </aside>
  </section>
</section>


</div>

<div class="funnel-tools-funnel funnel-tools-funnel-course-gem">
  <section class="newsletter-top">
  <img src="/images/newsletter/brandon-hilkert-point-down.png" alt="Brandon Hilkert pointing down">
</section>
<section class="newsletter clearfix">
  <div class="ribbon">
    <span>
      Join 1,300+ Rubyists
    </span>
  </div>
  <section class="picture" style="padding-top: 30px;">
    <img src="/images/newsletter/ruby-logo.png" alt="Ruby lanugage logo">
  </section>
  <section class="signup">
    <h2>Want to Build a Ruby Gem?</h2>
    <h3>A <strong>FREE</strong> 10-day email course helping you <br />build a Ruby Gem from start to finish.</h3>

    <form data-drip-embedded-form="8461781" action="https://www.getdrip.com/forms/8461781/submissions" method="post">
  <div class="email-input-container">
    <input type="email" value="" name="fields[email]" class="email" placeholder="your@email.com" required>
  </div>
  <input type="hidden" name="fields[location]" value="A Path to Services - Part 2 - Synchronous vs. Asynchronous" />
  <input type="submit" value="I want the FREE course!" name="subscribe" class="button">
  <br class="clear">
</form>



    <aside>
      I hate spam as much as you do!
      <br />
      Unsubscribe at any time.
    </aside>
  </section>
</section>



</div>

<div class="funnel-tools-funnel funnel-tools-funnel-book-gem">
  <section class="newsletter-top">
  <img src="/images/newsletter/brandon-hilkert-point-down.png" alt="Brandon Hilkert pointing down">
</section>
<section class="newsletter clearfix">
  <div class="ribbon">
    <span>
      Join 400+ Rubyists
    </span>
  </div>
  <section class="picture">
    <img src="/images/newsletter/build-a-ruby-gem-book.png" style="padding-bottom: 15px;" alt="Build a Ruby Gem book">
  </section>
  <section class="signup">
    <h2>Build a Ruby Gem</h2>
    <h3>Learn to build a <br />Ruby gem from start to finish</h3>
    <h3>19 chapters and 2+ hours of screencasts</h3>
    <h3>Use the link below to get <strong>25% off</strong> any package</h3>
    <a href="/books/build-a-ruby-gem/?utm_source=fo&utm_medium=web&utm_campaign=fo14&c=fo14" class="button">Take me to the book!</a>
  </section>
</section>

</div>

<script>
  FunnelTools.Funnel.load();
</script>

  

  


</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">

    
    <a href="http://bufferapp.com/add" class="buffer-add-button" data-count="horizontal" data-via="brandonhilkert" >Buffer</a>
    <script type="text/javascript" src="http://static.bufferapp.com/js/button.js"></script>
    

    
    <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    

    
    <a class="addthis_button_tweet"></a>
    

    
    <script type="IN/Share" data-counter="right"></script>
    

    
    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    

	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



  <section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>
			</div>
      
        <footer id="footer" class="inner"><ul>
  <li>
    <h4>Categories</h4>
    <ul>
      <li><a href="/blog/categories/ruby/">Ruby</a></li>
      <li><a href="/blog/categories/rails/">Rails</a></li>
      <li><a href="/blog/categories/open-source/">Open Source</a></li>
      <li><a href="/blog/categories/marketing/">Marketing</a></li>
      <li><a href="/blog/categories/email-course/">Email Course</a></li>
      <li><a href="/blog/categories/book/">Book</a></li>
    </ul>
  </li>
  <li>
    <h4>Popular Posts</h4>
<ul>
  <li>
    <a href="/blog/7-reasons-why-im-sticking-with-minitest-and-fixtures-in-rails/">7 Reasons I'm sticking with Minitest</a>
  </li>
  <li>
    <a href="/blog/organizing-javascript-in-rails-application-with-turbolinks/">Organizing JS in Rails w/ Turbolinks</a>
  </li>
  <li>
    <a href="/blog/using-rails-4-dot-1-secrets-for-configuration/">Using Rails 4 Secrets for Config</a>
  </li>
  <li>
    <a href="/blog/using-rails-fixtures-to-seed-a-database/">Using Fixtures to Seed a Database</a>
  </li>
  <li>
    <a href="/blog/ruby-gem-configuration-patterns/">Ruby Gem Configuration Patterns</a>
  </li>
  <!-- <li> -->
  <!--   <a href="/blog/how&#45;to&#45;build&#45;a&#45;rails&#45;engine/">How to Build a Rails Engine</a> -->
  <!-- </li> -->
  <!-- <li> -->
  <!--   <a href="/blog/why&#45;i&#45;wrote&#45;the&#45;sucker&#45;punch&#45;gem/">Why I Wrote the Sucker Punch Gem</a> -->
  <!-- </li> -->
  <!-- <li> -->
  <!--   <a href="/blog/setting&#45;up&#45;a&#45;cloudfront&#45;cdn&#45;for&#45;rails/">Setup a Cloudfront CDN for Rails</a> -->
  <!-- </li> -->
  <!-- <li> -->
  <!--   <a href="/blog/3&#45;ways&#45;to&#45;get&#45;started&#45;contributing&#45;to&#45;open&#45;source/">Get Started with Open Source</a> -->
  <!-- </li> -->
</ul>


  </li>
</ul>
<br class="clear" />
<p>
  &copy; 2017 Big Blue Media, LLC. All rights reserved.
</p>
</footer>
        <script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'brandonhilkert';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://brandonhilkert.com/blog/a-path-to-services-part-2-synchronous-vs-asynchronous/';
        var disqus_url = 'http://brandonhilkert.com/blog/a-path-to-services-part-2-synchronous-vs-asynchronous/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



      
		</div>
	</div>
  <link href="/stylesheets/funnel-tools-capture.css" media="screen, projection" rel="stylesheet" type="text/css">

<div id="funnel-tools-capture" class="bounceInUp">
  <div class="close">&#10005;</div>
  <div class="open">&#8593;</div>

  <div class="title">
    Build a Ruby Gem Course - FREE!
  </div>
  <div class="description">
    <p>
      Join <strong>1,300+</strong> other Rubyists and take your Ruby gem skills to the next level!
    </p>
    <p>
      Whether you're an expert Rubyist, or just starting out,
      this <strong>FREE 10-day</strong> email course will guide you through
      the process of creating your own Ruby gems from start to finish.
    </p>

    <p>
      Enter your email below to get started today:
    </p>
  </div>

  <form data-drip-embedded-form="8461781" action="https://www.getdrip.com/forms/8461781/submissions" method="post">
  <div class="email-input-container">
    <input type="email" value="" name="fields[email]" class="email" placeholder="your@email.com" required>
  </div>
  <input type="hidden" name="fields[location]" value="A Path to Services - Part 2 - Synchronous vs. Asynchronous" />
  <input type="submit" value="I want the FREE course!" name="subscribe" class="button">
  <br class="clear">
</form>


  <p class="funnel-tools-footer">
  Powered by <a href="http://brandonhilkert.com/tools?utm_source=bh-com&utm_medium=web&utm_campaign=ft-capture">Funnel Tools</a>
</p>

</div>


<script src="/javascripts/funnel-tools-capture.min.js"></script>


  <!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '7901432';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/7901432.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>

</body>
</html>
